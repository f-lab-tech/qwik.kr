import{i as n,u as s}from"./q-c0df5510.js";const c=[{text:"Retrieving Data",id:"retrieving-data",level:1},{text:"File Layout",id:"file-layout",level:2},{text:"Implement onGet",id:"implement-onget",level:2},{text:"Using onGet in a Component",id:"using-onget-in-a-component",level:2}],r={title:"Qwik City - Retrieving Data",meta:[],styles:[],links:[]},i={title:"Qwik City - Retrieving Data"};function t(a){const e=Object.assign({h1:"h1",a:"a",span:"span",p:"p",code:"code",h2:"h2",pre:"pre",ol:"ol",li:"li"},a.components);return n(s,{children:[n(e.h1,{id:"retrieving-data",children:[n(e.a,{"aria-hidden":"true",tabIndex:"-1",href:"#retrieving-data",children:n(e.span,{className:"icon icon-link"})}),"Retrieving Data"]}),`
`,n(e.p,{children:["Let's implement ",n(e.code,{children:"https://example.com/product/abc123"})," so that we can retrieve the details of a product."]}),`
`,n(e.h2,{id:"file-layout",children:[n(e.a,{"aria-hidden":"true",tabIndex:"-1",href:"#file-layout",children:n(e.span,{className:"icon icon-link"})}),"File Layout"]}),`
`,n(e.p,{children:["The first step is to structure the directories and files so that we can create the ",n(e.code,{children:"/product/abc123"})," route."]}),`
`,n(e.pre,{children:n(e.code,{children:`\u2500\u2500src/
  \u2514\u2500routes/
    \u2514\u2500product/
        \u2514\u2500[skuId]/
            \u2514\u2500index.tsx     # https://example.com/product/1234
`})}),`
`,n(e.h2,{id:"implement-onget",children:[n(e.a,{"aria-hidden":"true",tabIndex:"-1",href:"#implement-onget",children:n(e.span,{className:"icon icon-link"})}),"Implement onGet"]}),`
`,n(e.p,{children:['In a "page" endpoint context, an ',n(e.code,{children:"onGet"})," function retrieves data (typically from a database, or other stores). The retrieved data can be returned directly as JSON (",n(e.code,{children:"Accept: application/json"}),") or used as an input to the component to render HTML (",n(e.code,{children:"Accept: text/html"}),"). The ",n(e.code,{children:"onGet"})," function receives the ",n(e.code,{children:"params"})," to extract the parameters used to do data lookup."]}),`
`,n(e.p,{children:["In this example, the ",n(e.code,{children:"onGet"})," function returns the product data that is used inside of our component with the ",n(e.code,{children:"useEndpoint()"})," function."]}),`
`,n(e.pre,{children:n(e.code,{className:"language-typescript",children:[n(e.span,{className:"token comment",children:"// File: src/routes/product/[skuId]/details/index.tsx"}),`
`,n(e.span,{className:"token keyword",children:"import"})," ",n(e.span,{className:"token keyword",children:"type"})," ",n(e.span,{className:"token punctuation",children:"{"})," RequestHandler ",n(e.span,{className:"token punctuation",children:"}"})," ",n(e.span,{className:"token keyword",children:"from"})," ",n(e.span,{className:"token string",children:"'@builder.io/qwik-city'"}),n(e.span,{className:"token punctuation",children:";"}),`

`,n(e.span,{className:"token keyword",children:"interface"})," ",n(e.span,{className:"token class-name",children:"ProductData"})," ",n(e.span,{className:"token punctuation",children:"{"}),`
  skuId`,n(e.span,{className:"token operator",children:":"})," ",n(e.span,{className:"token builtin",children:"string"}),n(e.span,{className:"token punctuation",children:";"}),`
  price`,n(e.span,{className:"token operator",children:":"})," ",n(e.span,{className:"token builtin",children:"number"}),n(e.span,{className:"token punctuation",children:";"}),`
  description`,n(e.span,{className:"token operator",children:":"})," ",n(e.span,{className:"token builtin",children:"string"}),n(e.span,{className:"token punctuation",children:";"}),`
`,n(e.span,{className:"token punctuation",children:"}"}),`

`,n(e.span,{className:"token keyword",children:"export"})," ",n(e.span,{className:"token keyword",children:"const"})," onGet",n(e.span,{className:"token operator",children:":"})," RequestHandler",n(e.span,{className:"token operator",children:"<"}),"ProductData",n(e.span,{className:"token operator",children:">"})," ",n(e.span,{className:"token operator",children:"="})," ",n(e.span,{className:"token keyword",children:"async"})," ",n(e.span,{className:"token punctuation",children:"("}),n(e.span,{className:"token punctuation",children:"{"})," params ",n(e.span,{className:"token punctuation",children:"}"}),n(e.span,{className:"token punctuation",children:")"})," ",n(e.span,{className:"token operator",children:"=>"})," ",n(e.span,{className:"token punctuation",children:"{"}),`
  `,n(e.span,{className:"token comment",children:"// put your DB access here, we are hard coding a response for simplicity."}),`
  `,n(e.span,{className:"token keyword",children:"return"})," ",n(e.span,{className:"token punctuation",children:"{"}),`
    skuId`,n(e.span,{className:"token operator",children:":"})," params",n(e.span,{className:"token punctuation",children:"."}),"skuId",n(e.span,{className:"token punctuation",children:","}),`
    price`,n(e.span,{className:"token operator",children:":"})," ",n(e.span,{className:"token number",children:"123.45"}),n(e.span,{className:"token punctuation",children:","}),`
    description`,n(e.span,{className:"token operator",children:":"})," ",n(e.span,{className:"token template-string",children:[n(e.span,{className:"token template-punctuation string",children:"`"}),n(e.span,{className:"token string",children:"Description for "}),n(e.span,{className:"token interpolation",children:[n(e.span,{className:"token interpolation-punctuation punctuation",children:"${"}),"params",n(e.span,{className:"token punctuation",children:"."}),"skuId",n(e.span,{className:"token interpolation-punctuation punctuation",children:"}"})]}),n(e.span,{className:"token template-punctuation string",children:"`"})]}),n(e.span,{className:"token punctuation",children:","}),`
  `,n(e.span,{className:"token punctuation",children:"}"}),n(e.span,{className:"token punctuation",children:";"}),`
`,n(e.span,{className:"token punctuation",children:"}"}),n(e.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,n(e.h2,{id:"using-onget-in-a-component",children:[n(e.a,{"aria-hidden":"true",tabIndex:"-1",href:"#using-onget-in-a-component",children:n(e.span,{className:"icon icon-link"})}),"Using ",n(e.code,{children:"onGet"})," in a Component"]}),`
`,n(e.p,{children:["An endpoint ",n(e.code,{children:"onGet"})," function retrieves data and makes it available to the component using ",n(e.code,{children:"useEndpoint()"}),"."]}),`
`,n(e.pre,{children:n(e.code,{className:"language-typescript",children:[n(e.span,{className:"token keyword",children:"import"})," ",n(e.span,{className:"token punctuation",children:"{"})," Resource",n(e.span,{className:"token punctuation",children:","})," component$",n(e.span,{className:"token punctuation",children:","})," useStore ",n(e.span,{className:"token punctuation",children:"}"})," ",n(e.span,{className:"token keyword",children:"from"})," ",n(e.span,{className:"token string",children:"'@builder.io/qwik'"}),n(e.span,{className:"token punctuation",children:";"}),`
`,n(e.span,{className:"token keyword",children:"import"})," ",n(e.span,{className:"token keyword",children:"type"})," ",n(e.span,{className:"token punctuation",children:"{"})," RequestHandler ",n(e.span,{className:"token punctuation",children:"}"})," ",n(e.span,{className:"token keyword",children:"from"})," ",n(e.span,{className:"token string",children:"'@builder.io/qwik-city'"}),n(e.span,{className:"token punctuation",children:";"}),`
`,n(e.span,{className:"token keyword",children:"import"})," ",n(e.span,{className:"token punctuation",children:"{"})," useEndpoint ",n(e.span,{className:"token punctuation",children:"}"})," ",n(e.span,{className:"token keyword",children:"from"})," ",n(e.span,{className:"token string",children:'"@builder.io/qwik-city"'}),n(e.span,{className:"token punctuation",children:";"}),`


`,n(e.span,{className:"token keyword",children:"interface"})," ",n(e.span,{className:"token class-name",children:"ProductData"})," ",n(e.span,{className:"token punctuation",children:"{"})," ",n(e.span,{className:"token operator",children:"..."})," ",n(e.span,{className:"token punctuation",children:"}"}),`
`,n(e.span,{className:"token keyword",children:"export"})," ",n(e.span,{className:"token keyword",children:"const"})," onGet",n(e.span,{className:"token operator",children:":"})," RequestHandler",n(e.span,{className:"token operator",children:"<"}),"ProductData",n(e.span,{className:"token operator",children:">"})," ",n(e.span,{className:"token operator",children:"="})," ",n(e.span,{className:"token keyword",children:"async"})," ",n(e.span,{className:"token punctuation",children:"("}),n(e.span,{className:"token punctuation",children:"{"})," params ",n(e.span,{className:"token punctuation",children:"}"}),n(e.span,{className:"token punctuation",children:")"})," ",n(e.span,{className:"token operator",children:"=>"})," ",n(e.span,{className:"token punctuation",children:"{"})," ",n(e.span,{className:"token operator",children:"..."})," ",n(e.span,{className:"token punctuation",children:"}"}),n(e.span,{className:"token punctuation",children:";"}),`

`,n(e.span,{className:"token keyword",children:"export"})," ",n(e.span,{className:"token keyword",children:"default"})," ",n(e.span,{className:"token function",children:"component$"}),n(e.span,{className:"token punctuation",children:"("}),n(e.span,{className:"token punctuation",children:"("}),n(e.span,{className:"token punctuation",children:")"})," ",n(e.span,{className:"token operator",children:"=>"})," ",n(e.span,{className:"token punctuation",children:"{"}),`
  `,n(e.span,{className:"token keyword",children:"const"})," productData ",n(e.span,{className:"token operator",children:"="})," ",n(e.span,{className:"token generic-function",children:[n(e.span,{className:"token function",children:"useEndpoint"}),n(e.span,{className:"token generic class-name",children:[n(e.span,{className:"token operator",children:"<"}),"ProductData",n(e.span,{className:"token operator",children:">"})]})]}),n(e.span,{className:"token punctuation",children:"("}),n(e.span,{className:"token punctuation",children:")"}),n(e.span,{className:"token punctuation",children:";"}),`
  `,n(e.span,{className:"token keyword",children:"return"})," ",n(e.span,{className:"token punctuation",children:"("}),`
    `,n(e.span,{className:"token operator",children:"<"}),`Resource
      value`,n(e.span,{className:"token operator",children:"="}),n(e.span,{className:"token punctuation",children:"{"}),"productData",n(e.span,{className:"token punctuation",children:"}"}),`
      onPending`,n(e.span,{className:"token operator",children:"="}),n(e.span,{className:"token punctuation",children:"{"}),n(e.span,{className:"token punctuation",children:"("}),n(e.span,{className:"token punctuation",children:")"})," ",n(e.span,{className:"token operator",children:"=>"})," ",n(e.span,{className:"token operator",children:"<"}),"div",n(e.span,{className:"token operator",children:">"}),"Loading",n(e.span,{className:"token operator",children:"..."}),n(e.span,{className:"token operator",children:"<"}),n(e.span,{className:"token operator",children:"/"}),"div",n(e.span,{className:"token operator",children:">"}),n(e.span,{className:"token punctuation",children:"}"}),`
      onRejected`,n(e.span,{className:"token operator",children:"="}),n(e.span,{className:"token punctuation",children:"{"}),n(e.span,{className:"token punctuation",children:"("}),n(e.span,{className:"token punctuation",children:")"})," ",n(e.span,{className:"token operator",children:"=>"})," ",n(e.span,{className:"token operator",children:"<"}),"div",n(e.span,{className:"token operator",children:">"}),"Error",n(e.span,{className:"token operator",children:"<"}),n(e.span,{className:"token operator",children:"/"}),"div",n(e.span,{className:"token operator",children:">"}),n(e.span,{className:"token punctuation",children:"}"}),`
      onResolved`,n(e.span,{className:"token operator",children:"="}),n(e.span,{className:"token punctuation",children:"{"}),n(e.span,{className:"token punctuation",children:"("}),"product",n(e.span,{className:"token punctuation",children:")"})," ",n(e.span,{className:"token operator",children:"=>"})," ",n(e.span,{className:"token punctuation",children:"("}),`
        `,n(e.span,{className:"token operator",children:"<"}),n(e.span,{className:"token operator",children:">"}),`
          `,n(e.span,{className:"token operator",children:"<"}),"h1",n(e.span,{className:"token operator",children:">"}),"Product",n(e.span,{className:"token operator",children:":"})," ",n(e.span,{className:"token punctuation",children:"{"}),"product",n(e.span,{className:"token punctuation",children:"."}),"skuId",n(e.span,{className:"token punctuation",children:"}"}),n(e.span,{className:"token operator",children:"<"}),n(e.span,{className:"token operator",children:"/"}),"h1",n(e.span,{className:"token operator",children:">"}),`
          `,n(e.span,{className:"token operator",children:"<"}),"p",n(e.span,{className:"token operator",children:">"}),"Price",n(e.span,{className:"token operator",children:":"})," ",n(e.span,{className:"token punctuation",children:"{"}),"product",n(e.span,{className:"token punctuation",children:"."}),"price",n(e.span,{className:"token punctuation",children:"}"}),n(e.span,{className:"token operator",children:"<"}),n(e.span,{className:"token operator",children:"/"}),"p",n(e.span,{className:"token operator",children:">"}),`
          `,n(e.span,{className:"token operator",children:"<"}),"p",n(e.span,{className:"token operator",children:">"}),n(e.span,{className:"token punctuation",children:"{"}),"product",n(e.span,{className:"token punctuation",children:"."}),"description",n(e.span,{className:"token punctuation",children:"}"}),n(e.span,{className:"token operator",children:"<"}),n(e.span,{className:"token operator",children:"/"}),"p",n(e.span,{className:"token operator",children:">"}),`
        `,n(e.span,{className:"token operator",children:"<"}),n(e.span,{className:"token operator",children:"/"}),n(e.span,{className:"token operator",children:">"}),`
      `,n(e.span,{className:"token punctuation",children:")"}),n(e.span,{className:"token punctuation",children:"}"}),`
    `,n(e.span,{className:"token operator",children:"/"}),n(e.span,{className:"token operator",children:">"}),`
  `,n(e.span,{className:"token punctuation",children:")"}),n(e.span,{className:"token punctuation",children:";"}),`
`,n(e.span,{className:"token punctuation",children:"}"}),n(e.span,{className:"token punctuation",children:")"}),n(e.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,n(e.ol,{children:[`
`,n(e.li,{children:["Notice that the data endpoint and the component are defined in the same file. The data endpoint is serviced by the ",n(e.code,{children:"onGet"})," function and the component is by the modules default export."]}),`
`,n(e.li,{children:["The component uses ",n(e.code,{children:"useEndpoint()"})," function to retrieve the data. The ",n(e.code,{children:"useEndpoint()"})," function invokes ",n(e.code,{children:"onGet"})," function directly on the server but using ",n(e.code,{children:"fetch()"})," on the client. Your component does not need to think about server/client differences when using data. The ",n(e.code,{children:"useEndpoint()"})," function returns an object of type ",n(e.code,{children:"ResourceReturn"}),". ",n(e.code,{children:"Resource"}),"s are promise-like objects that can be serialized by Qwik."]}),`
`,n(e.li,{children:["The ",n(e.code,{children:"onGet"})," function is invoked before the component. This allows the ",n(e.code,{children:"onGet"})," to return 404 or redirect in case the data is not available."]}),`
`,n(e.li,{children:["Notice the use of ",n(e.code,{children:"<Resource>"})," JSX element. The purpose of ",n(e.code,{children:"Resource"})," is to allow the client to render different states of the ",n(e.code,{children:"useEndpoint()"})," resource."]}),`
`,n(e.li,{children:["On the server the ",n(e.code,{children:"<Resource>"})," element will pause rendering until the ",n(e.code,{children:"Resource"})," is resolved or rejected. This is because we don't want the server to render ",n(e.code,{children:"loading..."}),". (The server needs to know when the component is ready for serialization into HTML.)"]}),`
`,n(e.li,{children:["You may use ",n(e.code,{children:"typeof onGet"})," to keep your ",n(e.code,{children:"onGet"})," function and ",n(e.code,{children:"useEndpoint()"})," types in sync. TypeScript is smart enough to determine the types for you."]}),`
`]}),`
`,n(e.p,{children:"All of the above is done to abstract the data access from the component in a way that results in correct behavior on both the server and the client."})]})}function l(a={}){const{wrapper:e}=a.components||{};return e?n(e,Object.assign({},a,{children:n(t,a)})):t(a)}export{l as default,i as frontmatter,r as head,c as headings};
