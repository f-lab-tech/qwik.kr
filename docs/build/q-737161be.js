import{i as e,u as s}from"./q-c0df5510.js";const o=[{text:"QRL",id:"qrl",level:1},{text:"QRL Encoding",id:"qrl-encoding",level:2},{text:"Encoding lexically scoped captured variables",id:"encoding-lexically-scoped-captured-variables",level:2},{text:"Example",id:"example",level:3},{text:"Rendered HTML",id:"rendered-html",level:3},{text:"Why not just dynamic import()?",id:"why-not-just-dynamic-import",level:1},{text:"See Also",id:"see-also",level:1}],l={title:"QRL",meta:[],styles:[],links:[]},i={title:"QRL",fetch:"https://hackmd.io/@mhevery/r1TNrhAxq"};function t(a){const n=Object.assign({h1:"h1",a:"a",span:"span",p:"p",ul:"ul",li:"li",code:"code",h2:"h2",pre:"pre",h3:"h3",ol:"ol",blockquote:"blockquote",strong:"strong"},a.components);return e(s,{children:[e(n.h1,{id:"qrl",children:[e(n.a,{"aria-hidden":"true",tabIndex:"-1",href:"#qrl",children:e(n.span,{className:"icon icon-link"})}),"QRL"]}),`
`,e(n.p,{children:"QRL (Qwik URL) is a particular form of URL that Qwik uses to lazy load content."}),`
`,e(n.p,{children:"QRLs are:"}),`
`,e(n.ul,{children:[`
`,e(n.li,{children:"Specially formatted URLs that are left as attributes in the HTML to tell Qwik where the handlers for the code should be loaded from."}),`
`,e(n.li,{children:"URLs that point to JavaScript chunk to be lazy-loaded."}),`
`,e(n.li,{children:"Contain symbol name which needs to be retrieved from the chunk"}),`
`,e(n.li,{children:"May contain lexically scoped object references. (Captured variables from closures.)"}),`
`,e(n.li,{children:["If relative use ",e(n.code,{children:"q:base"})," for resolution."]}),`
`]}),`
`,e(n.h2,{id:"qrl-encoding",children:[e(n.a,{"aria-hidden":"true",tabIndex:"-1",href:"#qrl-encoding",children:e(n.span,{className:"icon icon-link"})}),"QRL Encoding"]}),`
`,e(n.pre,{children:e(n.code,{children:`./path/to/chunk.js#SymbolName
`})}),`
`,e(n.p,{children:["In its simplest form, the QRL contains a ",e(n.code,{children:"./path/to/chunk.js"}),", a URL that the browser can use to lazy-load a resource, and a ",e(n.code,{children:"SymbolName"})," to retrieve from the lazy-loaded chunk."]}),`
`,e(n.p,{children:["Qwik uses ",e(n.code,{children:"q:base"})," to resolve a QRL into an absolute URL if the URL is relative. (If no ",e(n.code,{children:"q:base"})," attribute is present, then ",e(n.code,{children:"document.baseURI"})," is used as a base.)"]}),`
`,e(n.h2,{id:"encoding-lexically-scoped-captured-variables",children:[e(n.a,{"aria-hidden":"true",tabIndex:"-1",href:"#encoding-lexically-scoped-captured-variables",children:e(n.span,{className:"icon icon-link"})}),"Encoding lexically scoped captured variables"]}),`
`,e(n.p,{children:["QRLs can also restore lexically scoped variables. In that case, the variables are encoded in the QRL at the end in the form of an array of indexes into the ",e(n.code,{children:"q:obj"})," attribute."]}),`
`,e(n.pre,{children:e(n.code,{children:`./path/to/chunk.js#SymbolName[0,2]
`})}),`
`,e(n.p,{children:["The array is used by ",e(n.code,{children:"useLexicalScope()"})," to restore the variables."]}),`
`,e(n.h3,{id:"example",children:[e(n.a,{"aria-hidden":"true",tabIndex:"-1",href:"#example",children:e(n.span,{className:"icon icon-link"})}),"Example"]}),`
`,e(n.p,{children:"Let's look at an example of how all of the pieces of the QRL tie together."}),`
`,e(n.p,{children:"The developer writes code for a simple component."}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"const"})," Counter ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token function",children:"component$"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:"("}),"props",e(n.span,{className:"token operator",children:":"})," ",e(n.span,{className:"token punctuation",children:"{"})," step",e(n.span,{className:"token operator",children:":"})," ",e(n.span,{className:"token builtin",children:"number"})," ",e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token punctuation",children:"{"}),`
  `,e(n.span,{className:"token keyword",children:"const"})," state ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token function",children:"useStore"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:"{"})," count",e(n.span,{className:"token operator",children:":"})," ",e(n.span,{className:"token number",children:"0"})," ",e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`

  `,e(n.span,{className:"token keyword",children:"return"})," ",e(n.span,{className:"token tag",children:[e(n.span,{className:"token tag",children:[e(n.span,{className:"token punctuation",children:"<"}),"button"]})," ",e(n.span,{className:"token attr-name",children:"onClick$"}),e(n.span,{className:"token script language-javascript",children:[e(n.span,{className:"token script-punctuation punctuation",children:"="}),e(n.span,{className:"token punctuation",children:"{"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token punctuation",children:"("}),"state",e(n.span,{className:"token punctuation",children:"."}),"count ",e(n.span,{className:"token operator",children:"+="})," props",e(n.span,{className:"token punctuation",children:"."}),"step ",e(n.span,{className:"token operator",children:"||"})," ",e(n.span,{className:"token number",children:"1"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:"}"})]}),e(n.span,{className:"token punctuation",children:">"})]}),e(n.span,{className:"token punctuation",children:"{"}),"state",e(n.span,{className:"token punctuation",children:"."}),"count",e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token tag",children:[e(n.span,{className:"token tag",children:[e(n.span,{className:"token punctuation",children:"</"}),"button"]}),e(n.span,{className:"token punctuation",children:">"})]}),e(n.span,{className:"token punctuation",children:";"}),`
`,e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.p,{children:"The optimizer breaks above code into pieces like so:"}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"const"})," Counter ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token function",children:"component"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token function",children:"qrl"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token string",children:"'./chunk-a.js'"}),e(n.span,{className:"token punctuation",children:","})," ",e(n.span,{className:"token string",children:"'Counter_onMount'"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.p,{children:[e(n.code,{children:"chunk-a.js"}),":"]}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"export"})," ",e(n.span,{className:"token keyword",children:"const"})," ",e(n.span,{className:"token function-variable function",children:"Counter_onMount"})," ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token punctuation",children:"("}),"props",e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token punctuation",children:"{"}),`
  `,e(n.span,{className:"token keyword",children:"const"})," store ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token function",children:"useStore"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:"{"})," count",e(n.span,{className:"token operator",children:":"})," ",e(n.span,{className:"token number",children:"0"})," ",e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
  `,e(n.span,{className:"token keyword",children:"return"})," ",e(n.span,{className:"token function",children:"qrl"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token string",children:"'./chunk-b.js'"}),e(n.span,{className:"token punctuation",children:","})," ",e(n.span,{className:"token string",children:"'Counter_onRender'"}),e(n.span,{className:"token punctuation",children:","})," ",e(n.span,{className:"token punctuation",children:"["}),"store",e(n.span,{className:"token punctuation",children:","})," props",e(n.span,{className:"token punctuation",children:"]"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`,e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.p,{children:[e(n.code,{children:"chunk-b.js"}),":"]}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"const"})," ",e(n.span,{className:"token function-variable function",children:"Counter_onRender"})," ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token punctuation",children:"{"}),`
  `,e(n.span,{className:"token keyword",children:"const"})," ",e(n.span,{className:"token punctuation",children:"["}),"store",e(n.span,{className:"token punctuation",children:","})," props",e(n.span,{className:"token punctuation",children:"]"})," ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token function",children:"useLexicalScope"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
  `,e(n.span,{className:"token keyword",children:"return"})," ",e(n.span,{className:"token punctuation",children:"("}),`
    `,e(n.span,{className:"token tag",children:[e(n.span,{className:"token tag",children:[e(n.span,{className:"token punctuation",children:"<"}),"button"]})," ",e(n.span,{className:"token attr-name",children:"onClick$"}),e(n.span,{className:"token script language-javascript",children:[e(n.span,{className:"token script-punctuation punctuation",children:"="}),e(n.span,{className:"token punctuation",children:"{"}),e(n.span,{className:"token function",children:"qrl"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token string",children:"'./chunk-c.js'"}),e(n.span,{className:"token punctuation",children:","})," ",e(n.span,{className:"token string",children:"'Counter_onClick'"}),e(n.span,{className:"token punctuation",children:","})," ",e(n.span,{className:"token punctuation",children:"["}),"store",e(n.span,{className:"token punctuation",children:","})," props",e(n.span,{className:"token punctuation",children:"]"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:"}"})]}),e(n.span,{className:"token punctuation",children:">"})]}),e(n.span,{className:"token punctuation",children:"{"}),"store",e(n.span,{className:"token punctuation",children:"."}),"count",e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token tag",children:[e(n.span,{className:"token tag",children:[e(n.span,{className:"token punctuation",children:"</"}),"button"]}),e(n.span,{className:"token punctuation",children:">"})]}),`
  `,e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`,e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.p,{children:[e(n.code,{children:"chunk-c.js"}),":"]}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"const"})," ",e(n.span,{className:"token function-variable function",children:"Counter_onClick"})," ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token punctuation",children:"{"}),`
  `,e(n.span,{className:"token keyword",children:"const"})," ",e(n.span,{className:"token punctuation",children:"["}),"store",e(n.span,{className:"token punctuation",children:","})," props",e(n.span,{className:"token punctuation",children:"]"})," ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token function",children:"useLexicalScope"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
  `,e(n.span,{className:"token keyword",children:"return"})," ",e(n.span,{className:"token punctuation",children:"("}),"store",e(n.span,{className:"token punctuation",children:"."}),"count ",e(n.span,{className:"token operator",children:"+="})," props",e(n.span,{className:"token punctuation",children:"."}),"step ",e(n.span,{className:"token operator",children:"||"})," ",e(n.span,{className:"token number",children:"1"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`,e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.h3,{id:"rendered-html",children:[e(n.a,{"aria-hidden":"true",tabIndex:"-1",href:"#rendered-html",children:e(n.span,{className:"icon icon-link"})}),"Rendered HTML"]}),`
`,e(n.p,{children:"After the above code gets executed, it produces this HTML."}),`
`,e(n.p,{children:["Assume: ",e(n.code,{children:"http://localhost/index.html"})]}),`
`,e(n.pre,{children:e(n.code,{className:"language-html",children:[e(n.span,{className:"token tag",children:[e(n.span,{className:"token tag",children:[e(n.span,{className:"token punctuation",children:"<"}),"html"]}),e(n.span,{className:"token punctuation",children:">"})]}),`
  `,e(n.span,{className:"token tag",children:[e(n.span,{className:"token tag",children:[e(n.span,{className:"token punctuation",children:"<"}),"body"]})," ",e(n.span,{className:"token attr-name",children:[e(n.span,{className:"token namespace",children:"q:"}),"base"]}),e(n.span,{className:"token attr-value",children:[e(n.span,{className:"token punctuation attr-equals",children:"="}),e(n.span,{className:"token punctuation",children:'"'}),"/build/",e(n.span,{className:"token punctuation",children:'"'})]}),e(n.span,{className:"token punctuation",children:">"})]}),`
    `,e(n.span,{className:"token tag",children:[e(n.span,{className:"token tag",children:[e(n.span,{className:"token punctuation",children:"<"}),"button"]})," ",e(n.span,{className:"token attr-name",children:[e(n.span,{className:"token namespace",children:"q:"}),"obj"]}),e(n.span,{className:"token attr-value",children:[e(n.span,{className:"token punctuation attr-equals",children:"="}),e(n.span,{className:"token punctuation",children:'"'}),"456, 123",e(n.span,{className:"token punctuation",children:'"'})]})," ",e(n.span,{className:"token attr-name",children:[e(n.span,{className:"token namespace",children:"on:"}),"click"]}),e(n.span,{className:"token attr-value",children:[e(n.span,{className:"token punctuation attr-equals",children:"="}),e(n.span,{className:"token punctuation",children:'"'}),"./chunk-c.js#Counter_onClick[0,1]",e(n.span,{className:"token punctuation",children:'"'})]}),e(n.span,{className:"token punctuation",children:">"})]}),"0",e(n.span,{className:"token tag",children:[e(n.span,{className:"token tag",children:[e(n.span,{className:"token punctuation",children:"</"}),"button"]}),e(n.span,{className:"token punctuation",children:">"})]}),`
    `,e(n.span,{className:"token tag",children:[e(n.span,{className:"token tag",children:[e(n.span,{className:"token punctuation",children:"<"}),"script"]}),e(n.span,{className:"token punctuation",children:">"})]}),e(n.span,{className:"token script",children:e(n.span,{className:"token language-javascript",children:[`
      `,e(n.span,{className:"token comment",children:"/*Qwikloader script*/"}),`
    `]})}),e(n.span,{className:"token tag",children:[e(n.span,{className:"token tag",children:[e(n.span,{className:"token punctuation",children:"</"}),"script"]}),e(n.span,{className:"token punctuation",children:">"})]}),`
    `,e(n.span,{className:"token tag",children:[e(n.span,{className:"token tag",children:[e(n.span,{className:"token punctuation",children:"<"}),"script"]})," ",e(n.span,{className:"token attr-name",children:"type"}),e(n.span,{className:"token attr-value",children:[e(n.span,{className:"token punctuation attr-equals",children:"="}),e(n.span,{className:"token punctuation",children:'"'}),"qwik/json",e(n.span,{className:"token punctuation",children:'"'})]}),e(n.span,{className:"token punctuation",children:">"})]}),e(n.span,{className:"token script",children:e(n.span,{className:"token language-javascript",children:[`
      `,e(n.span,{className:"token punctuation",children:"{"}),e(n.span,{className:"token operator",children:"..."}),"json",e(n.span,{className:"token operator",children:"..."}),e(n.span,{className:"token punctuation",children:"}"}),`
    `]})}),e(n.span,{className:"token tag",children:[e(n.span,{className:"token tag",children:[e(n.span,{className:"token punctuation",children:"</"}),"script"]}),e(n.span,{className:"token punctuation",children:">"})]}),`
  `,e(n.span,{className:"token tag",children:[e(n.span,{className:"token tag",children:[e(n.span,{className:"token punctuation",children:"</"}),"body"]}),e(n.span,{className:"token punctuation",children:">"})]}),`
`,e(n.span,{className:"token tag",children:[e(n.span,{className:"token tag",children:[e(n.span,{className:"token punctuation",children:"</"}),"html"]}),e(n.span,{className:"token punctuation",children:">"})]}),`
`]})}),`
`,e(n.p,{children:["The main thing to note is the ",e(n.code,{children:"on:click"})," attribute. This attribute gets read by the Qwikloader when the user clicks on the button."]}),`
`,e(n.ol,{children:[`
`,e(n.li,{children:["HTML is loaded in the browser, and Qwikloader registers a global ",e(n.code,{children:"click"})," listener. No other JavaScript is loaded/executed at this point."]}),`
`,e(n.li,{children:["User clicks on the ",e(n.code,{children:"<button>"}),". This fires a ",e(n.code,{children:"click"})," event which bubbles up and is handled by the Qwikloader."]}),`
`,e(n.li,{children:["Qwikloader retraces the event bubble path and looks for ",e(n.code,{children:"on:click"})," attribute, which it finds on ",e(n.code,{children:"<button>"}),"."]}),`
`,e(n.li,{children:["Qwikloader now tries to load the corresponding chunk. To do that, the Qwikloader needs to resolve the relative path of ",e(n.code,{children:"./chunk-c.js"}),". It uses these values to build an absolute path starting at ",e(n.code,{children:"<button>"})," and walking towards the document.",`
`,e(n.ul,{children:[`
`,e(n.li,{children:e(n.code,{children:'on:click="./chunk-c.js#Counter_onClick[0,2]"'})}),`
`,e(n.li,{children:e(n.code,{children:'<body q:base="/build/">'})}),`
`,e(n.li,{children:e(n.code,{children:'document.baseURI = "http://localhost/index.html"'})}),`
`,e(n.li,{children:["The resulting absolute URL is ",e(n.code,{children:"http://localhost/build/chunk-c.js"})," which Qwikloader fetches."]}),`
`]}),`
`]}),`
`,e(n.li,{children:["Qwikloader now retrieves the ",e(n.code,{children:"Counter_onClick"})," reference from ",e(n.code,{children:"http://localhost/build/chunk-c.js"})," and invokes it.",`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"const"})," ",e(n.span,{className:"token function-variable function",children:"Counter_onClick"})," ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token punctuation",children:"{"}),`
  `,e(n.span,{className:"token keyword",children:"const"})," ",e(n.span,{className:"token punctuation",children:"["}),"store",e(n.span,{className:"token punctuation",children:","})," props",e(n.span,{className:"token punctuation",children:"]"})," ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token function",children:"useLexicalScope"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
  `,e(n.span,{className:"token keyword",children:"return"})," ",e(n.span,{className:"token punctuation",children:"("}),"store",e(n.span,{className:"token punctuation",children:"."}),"count ",e(n.span,{className:"token operator",children:"+="})," props",e(n.span,{className:"token punctuation",children:"."}),"step ",e(n.span,{className:"token operator",children:"||"})," ",e(n.span,{className:"token number",children:"1"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`,e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`]}),`
`,e(n.li,{children:"At this point, the execution is handed off from Qwikloader to the lazy-loaded chunk. This is done so that the Qwikloader can be as small as possible as it is inlined into the HTML."}),`
`,e(n.li,{children:[e(n.code,{children:"useLexicalScope"})," is imported from ",e(n.code,{children:"@builder.io/qwik"})," and is responsible for retrieving the ",e(n.code,{children:"store"})," and ",e(n.code,{children:"props"}),`.
`,e(n.code,{children:"const [store, props] = useLexicalScope();"})]}),`
`,e(n.li,{children:["Parse the ",e(n.code,{children:'<script type="qwik/json">{...json...}<\/script>'})," JSON and distribute the deserialized objects per ",e(n.code,{children:"q:obj"})," attribute. In our case",`
`,e(n.ul,{children:[`
`,e(n.li,{children:[e(n.code,{children:'<div q:id="123" q:obj="456" q:host>'})," gets object with id ",e(n.code,{children:"123"}),". This will be the ",e(n.code,{children:"store"})," created in the ",e(n.code,{children:"Counter_onMount"})," function."]}),`
`,e(n.li,{children:[e(n.code,{children:'<button q:obj="456, 123"'})," gets ",e(n.code,{children:"store"})," as well as reference to the ",e(n.code,{children:'<div q:id="457">'})]}),`
`]}),`
`]}),`
`,e(n.li,{children:["Once the ",e(n.code,{children:"qwik/json"})," is deserialized, ",e(n.code,{children:"useLexicalScope"})," can use the QRL's ",e(n.code,{children:"[0,1]"})," array to look into ",e(n.code,{children:'q:obj="456, 123"'})," to retrieve object with id ",e(n.code,{children:"456"})," and ",e(n.code,{children:"123"}),", which are props of ",e(n.code,{children:'<div q:id="123" q:obj="456" q:host>'})," as well as ",e(n.code,{children:"store"})," from ",e(n.code,{children:"Counter_onMount"})," function."]}),`
`]}),`
`,e(n.blockquote,{children:[`
`,e(n.p,{children:[e(n.strong,{children:"NOTE:"})," For performance reasons the ",e(n.code,{children:"q:obj"})," and ",e(n.code,{children:'<script type="qwik/json">'})," are only updated when the application is deserialized into HTML. When the application is running, these attributes may have stale values."]}),`
`]}),`
`,e(n.h1,{id:"why-not-just-dynamic-import",children:[e(n.a,{"aria-hidden":"true",tabIndex:"-1",href:"#why-not-just-dynamic-import",children:e(n.span,{className:"icon icon-link"})}),"Why not just dynamic ",e(n.code,{children:"import()"}),"?"]}),`
`,e(n.p,{children:["Browsers already have dynamic import mechanisms available from ",e(n.code,{children:"import()"}),". Why not use that instead of inventing a new QRL format?"]}),`
`,e(n.p,{children:"There are several reasons:"}),`
`,e(n.ol,{children:[`
`,e(n.li,{children:["For Qwik to work, the QRLs need to be serialized into HTML. This is problematic for dynamic ",e(n.code,{children:"import()"})," because there is no easy way to retrieve the relative URL from the ",e(n.code,{children:"import('./some-path.js')"})," so that it can be placed in the HTML."]}),`
`,e(n.li,{children:"Dynamic imports deal with chunks, but they have no mechanism to refer to a specific symbol in the chunk."}),`
`,e(n.li,{children:["Dynamic imports have relative paths to the file which imported it. This is a problem because when the relative path is placed in HTML, it loses the context which defines relative to what. When the framework reads the path from HTML and tries to import it as ",e(n.code,{children:"import(element.getAttribute('on:click'))"}),", the framework will become the context for relative path resolution. This is wrong as the original context before serialization to the HTML was different."]}),`
`,e(n.li,{children:"Finally, QRLs encode information about the lexically scoped variables captured in the closure and need to be restored."}),`
`,e(n.li,{children:["Requires that the developer writes ",e(n.code,{children:"import('./file-a.js')"}),", which means the developer is in charge of deciding where the lazy-loaded boundaries are. This limits our ability of the tooling to move code around in an automated way."]}),`
`]}),`
`,e(n.p,{children:"Because of the above differences, Qwik introduces QRLs as a mechanism for lazy load closures into a Qwik application."}),`
`,e(n.h1,{id:"see-also",children:[e(n.a,{"aria-hidden":"true",tabIndex:"-1",href:"#see-also",children:e(n.span,{className:"icon icon-link"})}),"See Also"]}),`
`,e(n.ul,{children:[`
`,e(n.li,{children:[e(n.code,{children:"qrl"}),": API used to create QRLs."]}),`
`,e(n.li,{children:[e(n.code,{children:"qImport"}),": API used to lazy load symbols from QRLs."]}),`
`]})]})}function r(a={}){const{wrapper:n}=a.components||{};return n?e(n,Object.assign({},a,{children:e(t,a)})):t(a)}export{r as default,i as frontmatter,l as head,o as headings};
