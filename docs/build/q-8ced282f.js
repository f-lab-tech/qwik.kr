import{i as e,u as c}from"./q-c0df5510.js";const o=[{text:"Optimizer",id:"optimizer",level:1},{text:"$ and Optimizer Rules",id:"-and-optimizer-rules",level:1},{text:"The meaning of $",id:"the-meaning-of-",level:2},{text:"Symbol extraction",id:"symbol-extraction",level:2},{text:"Capturing the lexical scope",id:"capturing-the-lexical-scope",level:1},{text:"Optimizer Rules",id:"optimizer-rules",level:1},{text:"Imports",id:"imports",level:2},{text:"Closures",id:"closures",level:2}],l={title:"Optimizer Rules",meta:[],styles:[],links:[]},i={title:"Optimizer Rules",fetch:"https://hackmd.io/@mhevery/rkydmxJZ9"};function s(a){const n=Object.assign({h1:"h1",a:"a",span:"span",p:"p",code:"code",pre:"pre",h2:"h2",ol:"ol",li:"li",ul:"ul",blockquote:"blockquote",strong:"strong"},a.components);return e(c,{children:[e(n.h1,{id:"optimizer",children:[e(n.a,{"aria-hidden":"true",tabIndex:"-1",href:"#optimizer",children:e(n.span,{className:"icon icon-link"})}),"Optimizer"]}),`
`,e(n.p,{children:"Qwik's philosophy is to delay loading code for as long as possible. To do that, Qwik relies on Optimizer to re-arrange the code for lazy loading. The Optimizer is code level transformation that runs as part of the rollup. (Optimizer is written in Rust (and available as WASM) for instant performance)"}),`
`,e(n.p,{children:["The Optimizer looks for ",e(n.code,{children:"$"})," and applies a transformation that extracts the expression following the ",e(n.code,{children:"$"})," and turns it into a lazy-loadable and importable symbol."]}),`
`,e(n.p,{children:["Let's start by looking at a simple ",e(n.code,{children:"Counter"})," example:"]}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"const"})," Counter ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token function",children:"component$"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token punctuation",children:"{"}),`
  `,e(n.span,{className:"token keyword",children:"const"})," store ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token function",children:"useStore"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:"{"})," count",e(n.span,{className:"token operator",children:":"})," ",e(n.span,{className:"token number",children:"0"})," ",e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`

  `,e(n.span,{className:"token keyword",children:"return"})," ",e(n.span,{className:"token tag",children:[e(n.span,{className:"token tag",children:[e(n.span,{className:"token punctuation",children:"<"}),"button"]})," ",e(n.span,{className:"token attr-name",children:"onClick$"}),e(n.span,{className:"token script language-javascript",children:[e(n.span,{className:"token script-punctuation punctuation",children:"="}),e(n.span,{className:"token punctuation",children:"{"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," store",e(n.span,{className:"token punctuation",children:"."}),"count",e(n.span,{className:"token operator",children:"++"}),e(n.span,{className:"token punctuation",children:"}"})]}),e(n.span,{className:"token punctuation",children:">"})]}),e(n.span,{className:"token punctuation",children:"{"}),"store",e(n.span,{className:"token punctuation",children:"."}),"count",e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token tag",children:[e(n.span,{className:"token tag",children:[e(n.span,{className:"token punctuation",children:"</"}),"button"]}),e(n.span,{className:"token punctuation",children:">"})]}),e(n.span,{className:"token punctuation",children:";"}),`
`,e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.p,{children:"The above code represents what a developer would write to describe the component. Below are the transformations that the Optimizer applies to the code to make the code lazy-loadable."}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"const"})," Counter ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token function",children:"component"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token function",children:"qrl"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token string",children:"'./chunk-a.js'"}),e(n.span,{className:"token punctuation",children:","})," ",e(n.span,{className:"token string",children:"'Counter_onMount'"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.p,{children:[e(n.code,{children:"chunk-a.js"}),":"]}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"export"})," ",e(n.span,{className:"token keyword",children:"const"})," ",e(n.span,{className:"token function-variable function",children:"Counter_onMount"})," ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token punctuation",children:"{"}),`
  `,e(n.span,{className:"token keyword",children:"const"})," store ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token function",children:"useStore"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:"{"})," count",e(n.span,{className:"token operator",children:":"})," ",e(n.span,{className:"token number",children:"0"})," ",e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
  `,e(n.span,{className:"token keyword",children:"return"})," ",e(n.span,{className:"token tag",children:[e(n.span,{className:"token tag",children:[e(n.span,{className:"token punctuation",children:"<"}),"button"]})," ",e(n.span,{className:"token attr-name",children:"onClick$"}),e(n.span,{className:"token script language-javascript",children:[e(n.span,{className:"token script-punctuation punctuation",children:"="}),e(n.span,{className:"token punctuation",children:"{"}),e(n.span,{className:"token function",children:"qrl"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token string",children:"'./chunk-b.js'"}),e(n.span,{className:"token punctuation",children:","})," ",e(n.span,{className:"token string",children:"'Counter_onClick'"}),e(n.span,{className:"token punctuation",children:","})," ",e(n.span,{className:"token punctuation",children:"["}),"store",e(n.span,{className:"token punctuation",children:"]"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:"}"})]}),e(n.span,{className:"token punctuation",children:">"})]}),e(n.span,{className:"token punctuation",children:"{"}),"store",e(n.span,{className:"token punctuation",children:"."}),"count",e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token tag",children:[e(n.span,{className:"token tag",children:[e(n.span,{className:"token punctuation",children:"</"}),"button"]}),e(n.span,{className:"token punctuation",children:">"})]}),e(n.span,{className:"token punctuation",children:";"}),`
`,e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.p,{children:[e(n.code,{children:"chunk-b.js"}),":"]}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"const"})," ",e(n.span,{className:"token function-variable function",children:"Counter_onClick"})," ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token punctuation",children:"{"}),`
  `,e(n.span,{className:"token keyword",children:"const"})," ",e(n.span,{className:"token punctuation",children:"["}),"store",e(n.span,{className:"token punctuation",children:"]"})," ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token function",children:"useLexicalScope"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
  `,e(n.span,{className:"token keyword",children:"return"})," store",e(n.span,{className:"token punctuation",children:"."}),"count",e(n.span,{className:"token operator",children:"++"}),e(n.span,{className:"token punctuation",children:";"}),`
`,e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.p,{children:["Notice that every occurrence of ",e(n.code,{children:"$"})," results in a new lazy loadable symbol."]}),`
`,e(n.h1,{id:"-and-optimizer-rules",children:[e(n.a,{"aria-hidden":"true",tabIndex:"-1",href:"#-and-optimizer-rules",children:e(n.span,{className:"icon icon-link"})}),e(n.code,{children:"$"})," and Optimizer Rules"]}),`
`,e(n.p,{children:"Optimizer runs as part of the bundling step of building the application. The purpose of the Optimizer is to break up the application into many small lazy-loadable chunks. The Optimizer moves expressions (usually functions) into new files and leaves behind a reference pointing to where the expression was moved."}),`
`,e(n.h2,{id:"the-meaning-of-",children:[e(n.a,{"aria-hidden":"true",tabIndex:"-1",href:"#the-meaning-of-",children:e(n.span,{className:"icon icon-link"})}),"The meaning of ",e(n.code,{children:"$"})]}),`
`,e(n.p,{children:"The Optimizer needs to know which expression should be extracted into a new file. Extracting a symbol is complicated because the reference to the symbol changes from direct to asynchronous loading. This means that Optimizer needs to cooperate with the runtime to know which symbols can be extracted and how the runtime can then load them."}),`
`,e(n.p,{children:"Let's look at the hypothetical problem of acting on scroll. You may be tempted to write the code like so:"}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"function"})," ",e(n.span,{className:"token function",children:"onScroll"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token function-variable function",children:"fn"}),e(n.span,{className:"token operator",children:":"})," ",e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token keyword",children:"void"}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token punctuation",children:"{"}),`
  document`,e(n.span,{className:"token punctuation",children:"."}),e(n.span,{className:"token function",children:"addEventListener"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token string",children:"'scroll'"}),e(n.span,{className:"token punctuation",children:","})," fn",e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`,e(n.span,{className:"token punctuation",children:"}"}),`

`,e(n.span,{className:"token function",children:"onScroll"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token function",children:"alert"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token string",children:"'scroll'"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.p,{children:"The problem with this approach is that the event handler is eagerly loaded, even if the scroll event never triggers. What is needed is a way to refer to code in a lazy loadable way."}),`
`,e(n.p,{children:"The developer could write:"}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"export"})," ",e(n.span,{className:"token function-variable function",children:"scrollHandler"})," ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token function",children:"alert"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token string",children:"'scroll'"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`

`,e(n.span,{className:"token function",children:"onScroll"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token keyword",children:"await"})," ",e(n.span,{className:"token keyword",children:"import"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token string",children:"'./some-chunk'"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:"."}),e(n.span,{className:"token function",children:"scrollHandler"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.p,{children:["This works but is a lot of work. The developer is responsible for putting the code in a different file and hard coding the chunk name. Instead, we use Optimizer to perform the work for us automatically. But we need a way to tell Optimizer that we want to perform such a refactoring. We use ",e(n.code,{children:"$()"})," as a marker function for this purpose."]}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"function"})," ",e(n.span,{className:"token function",children:"onScroll"}),e(n.span,{className:"token punctuation",children:"("}),"fnQrl",e(n.span,{className:"token operator",children:":"})," ",e(n.span,{className:"token constant",children:"QRL"}),e(n.span,{className:"token operator",children:"<"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token keyword",children:"void"}),e(n.span,{className:"token operator",children:">"}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token punctuation",children:"{"}),`
  document`,e(n.span,{className:"token punctuation",children:"."}),e(n.span,{className:"token function",children:"addEventListener"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token string",children:"'scroll'"}),e(n.span,{className:"token punctuation",children:","})," ",e(n.span,{className:"token keyword",children:"async"})," ",e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token punctuation",children:"{"}),`
    fn `,e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token keyword",children:"await"})," ",e(n.span,{className:"token function",children:"qImport"}),e(n.span,{className:"token punctuation",children:"("}),"document",e(n.span,{className:"token punctuation",children:","})," fnQrl",e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
    `,e(n.span,{className:"token function",children:"fn"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
  `,e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`,e(n.span,{className:"token punctuation",children:"}"}),`

`,e(n.span,{className:"token function",children:"onScroll"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token function",children:"$"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token function",children:"alert"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token string",children:"'clicked'"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.p,{children:"The Optimizer will generate:"}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token function",children:"onScroll"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token function",children:"qrl"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token string",children:"'./chunk-a.js'"}),e(n.span,{className:"token punctuation",children:","})," ",e(n.span,{className:"token string",children:"'onScroll_1'"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.p,{children:[e(n.code,{children:"chunk-a.js"}),":"]}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"export"})," ",e(n.span,{className:"token keyword",children:"const"})," ",e(n.span,{className:"token function-variable function",children:"onScroll_1"})," ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token function",children:"alert"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token string",children:"'scroll'"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.p,{children:"Notice:"}),`
`,e(n.ol,{children:[`
`,e(n.li,{children:["All that the developer had to do was to wrap the function in the ",e(n.code,{children:"$()"})," to signal to the Optimizer that the function should be moved to a new file and therefore lazy-loaded."]}),`
`,e(n.li,{children:["The ",e(n.code,{children:"onScroll"})," had to be implemented slightly differently as it needs to take into account the fact that the ",e(n.code,{children:"QRL"})," of the function needs to be loaded before it can be used. In practice using ",e(n.code,{children:"qImport"})," is rare in Qwik application as the Qwik framework provides higher-level APIs that rarely expect the developer to work with ",e(n.code,{children:"qImport"})," directly."]}),`
`]}),`
`,e(n.p,{children:["However, wrapping code in ",e(n.code,{children:"$()"})," is a bit inconvenient. For this reason, Optimizer implicitly wraps the first argument of any function call, which ends with ",e(n.code,{children:"$"}),". (Additionally, one can use ",e(n.code,{children:"implicit$FirstArg()"})," to automatically perform the wrapping and type matching of the function taking the ",e(n.code,{children:"QRL"}),".)"]}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"const"})," onScroll$ ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token function",children:"implicit$FirstArg"}),e(n.span,{className:"token punctuation",children:"("}),"onScroll",e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`

`,e(n.span,{className:"token function",children:"onScroll$"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token function",children:"alert"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token string",children:"'scroll'"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.p,{children:"Now the developer has a very easy syntax for expressing that a particular function should be lazy-loaded."}),`
`,e(n.h2,{id:"symbol-extraction",children:[e(n.a,{"aria-hidden":"true",tabIndex:"-1",href:"#symbol-extraction",children:e(n.span,{className:"icon icon-link"})}),"Symbol extraction"]}),`
`,e(n.p,{children:"Assume that you have this code:"}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"const"})," MyComp ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token function",children:"component$"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token punctuation",children:"{"}),`
  `,e(n.span,{className:"token comment",children:"/* my component definition */"}),`
`,e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.p,{children:"The Optimizer breaks the code up into two files:"}),`
`,e(n.p,{children:"The original file:"}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"const"})," MyComp ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token function",children:"component"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token function",children:"qrl"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token string",children:"'./chunk-a.js'"}),e(n.span,{className:"token punctuation",children:","})," ",e(n.span,{className:"token string",children:"'MyComp_onMount'"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.p,{children:[e(n.code,{children:"chunk-a.js"}),":"]}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"export"})," ",e(n.span,{className:"token keyword",children:"const"})," ",e(n.span,{className:"token function-variable function",children:"MyComp_onMount"})," ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token punctuation",children:"{"}),`
  `,e(n.span,{className:"token comment",children:"/* my component definition */"}),`
`,e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.p,{children:["The result of Optimizer is that the ",e(n.code,{children:"MyComp"}),"'s ",e(n.code,{children:"onMount"})," method was extracted into a new file. There are a few benefits to doing this:"]}),`
`,e(n.ul,{children:[`
`,e(n.li,{children:["A Parent component can refer to ",e(n.code,{children:"MyComp"})," without pulling in ",e(n.code,{children:"MyComp"})," implementation details."]}),`
`,e(n.li,{children:"The application now has more entry points, giving the bundler more ways to chunk up the codebase."}),`
`]}),`
`,e(n.p,{children:"See also: Capturing Lexical Scope."}),`
`,e(n.h1,{id:"capturing-the-lexical-scope",children:[e(n.a,{"aria-hidden":"true",tabIndex:"-1",href:"#capturing-the-lexical-scope",children:e(n.span,{className:"icon icon-link"})}),"Capturing the lexical scope"]}),`
`,e(n.p,{children:["The Optimizer extracts expressions (usually functions) into new files and leaves behind a ",e(n.code,{children:"QRL"})," pointing to the lazy-loaded location."]}),`
`,e(n.p,{children:"Let's look at a simple case:"}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"const"})," Greeter ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token function",children:"component$"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token punctuation",children:"{"}),`
  `,e(n.span,{className:"token keyword",children:"return"})," ",e(n.span,{className:"token tag",children:[e(n.span,{className:"token tag",children:[e(n.span,{className:"token punctuation",children:"<"}),"span"]}),e(n.span,{className:"token punctuation",children:">"})]}),e(n.span,{className:"token plain-text",children:"Hello World!"}),e(n.span,{className:"token tag",children:[e(n.span,{className:"token tag",children:[e(n.span,{className:"token punctuation",children:"</"}),"span"]}),e(n.span,{className:"token punctuation",children:">"})]}),e(n.span,{className:"token punctuation",children:";"}),`
`,e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.p,{children:"this will result in:"}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"const"})," Greeter ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token function",children:"component"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token function",children:"qrl"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token string",children:"'./chunk-a.js'"}),e(n.span,{className:"token punctuation",children:","})," ",e(n.span,{className:"token string",children:"'Greeter_onMount'"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.p,{children:[e(n.code,{children:"chunk-a.js"}),":"]}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"const"})," ",e(n.span,{className:"token function-variable function",children:"Greeter_onMount"})," ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token punctuation",children:"{"}),`
  `,e(n.span,{className:"token keyword",children:"return"})," ",e(n.span,{className:"token function",children:"qrl"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token string",children:"'./chunk-b.js'"}),e(n.span,{className:"token punctuation",children:","})," ",e(n.span,{className:"token string",children:"'Greeter_onRender'"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`,e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.p,{children:[e(n.code,{children:"chunk-b.js"}),":"]}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"const"})," ",e(n.span,{className:"token function-variable function",children:"Greeter_onRender"})," ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token tag",children:[e(n.span,{className:"token tag",children:[e(n.span,{className:"token punctuation",children:"<"}),"span"]}),e(n.span,{className:"token punctuation",children:">"})]}),e(n.span,{className:"token plain-text",children:"Hello World!"}),e(n.span,{className:"token tag",children:[e(n.span,{className:"token tag",children:[e(n.span,{className:"token punctuation",children:"</"}),"span"]}),e(n.span,{className:"token punctuation",children:">"})]}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.p,{children:"The above is for simple cases where the extracted function closure does not capture any variables. Let's look at a more complicated case where the extracted function closure lexically captures variables."}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"const"})," Greeter ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token function",children:"component$"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:"("}),"props",e(n.span,{className:"token operator",children:":"})," ",e(n.span,{className:"token punctuation",children:"{"})," name",e(n.span,{className:"token operator",children:":"})," ",e(n.span,{className:"token builtin",children:"string"})," ",e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token punctuation",children:"{"}),`
  `,e(n.span,{className:"token keyword",children:"const"})," salutation ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token string",children:"'Hello'"}),e(n.span,{className:"token punctuation",children:";"}),`

  `,e(n.span,{className:"token keyword",children:"return"})," ",e(n.span,{className:"token punctuation",children:"("}),`
    `,e(n.span,{className:"token tag",children:[e(n.span,{className:"token tag",children:[e(n.span,{className:"token punctuation",children:"<"}),"span"]}),e(n.span,{className:"token punctuation",children:">"})]}),e(n.span,{className:"token plain-text",children:`
      `}),e(n.span,{className:"token punctuation",children:"{"}),"salutation",e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token plain-text",children:" "}),e(n.span,{className:"token punctuation",children:"{"}),"props",e(n.span,{className:"token punctuation",children:"."}),"name",e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token plain-text",children:`!
    `}),e(n.span,{className:"token tag",children:[e(n.span,{className:"token tag",children:[e(n.span,{className:"token punctuation",children:"</"}),"span"]}),e(n.span,{className:"token punctuation",children:">"})]}),`
  `,e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`,e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.p,{children:"The naive way to extract functions will not work."}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"const"})," Greeter ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token function",children:"component"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token function",children:"qrl"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token string",children:"'./chunk-a.js'"}),e(n.span,{className:"token punctuation",children:","})," ",e(n.span,{className:"token string",children:"'Greeter_onMount'"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.p,{children:[e(n.code,{children:"chunk-a.js"}),":"]}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"const"})," ",e(n.span,{className:"token function-variable function",children:"Greeter_onMount"})," ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token punctuation",children:"("}),"props",e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token punctuation",children:"{"}),`
  `,e(n.span,{className:"token keyword",children:"const"})," salutation ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token string",children:"'Hello'"}),e(n.span,{className:"token punctuation",children:";"}),`
  `,e(n.span,{className:"token keyword",children:"return"})," ",e(n.span,{className:"token function",children:"qrl"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token string",children:"'./chunk-b.js'"}),e(n.span,{className:"token punctuation",children:","})," ",e(n.span,{className:"token string",children:"'Greeter_onRender'"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`,e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.p,{children:[e(n.code,{children:"chunk-b.js"}),":"]}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"const"})," ",e(n.span,{className:"token function-variable function",children:"Greeter_onRender"})," ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token punctuation",children:"("}),`
  `,e(n.span,{className:"token tag",children:[e(n.span,{className:"token tag",children:[e(n.span,{className:"token punctuation",children:"<"}),"span"]}),e(n.span,{className:"token punctuation",children:">"})]}),e(n.span,{className:"token plain-text",children:`
    `}),e(n.span,{className:"token punctuation",children:"{"}),"salutation",e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token plain-text",children:" "}),e(n.span,{className:"token punctuation",children:"{"}),"props",e(n.span,{className:"token punctuation",children:"."}),"name",e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token plain-text",children:`!
  `}),e(n.span,{className:"token tag",children:[e(n.span,{className:"token tag",children:[e(n.span,{className:"token punctuation",children:"</"}),"span"]}),e(n.span,{className:"token punctuation",children:">"})]}),`
`,e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.p,{children:["The issue can be seen in ",e(n.code,{children:"chunk-b.js"}),". The extracted function refers to ",e(n.code,{children:"salutation"})," and ",e(n.code,{children:"props"}),", which are no longer in the lexical scope of the function. For this reason, the generated code must be slightly different."]}),`
`,e(n.p,{children:[e(n.code,{children:"chunk-a.js"}),":"]}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"const"})," ",e(n.span,{className:"token function-variable function",children:"Greeter_onMount"})," ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token punctuation",children:"("}),"props",e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token punctuation",children:"{"}),`
  `,e(n.span,{className:"token keyword",children:"const"})," salutation ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token string",children:"'Hello'"}),e(n.span,{className:"token punctuation",children:";"}),`
  `,e(n.span,{className:"token keyword",children:"return"})," ",e(n.span,{className:"token function",children:"qrl"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token string",children:"'./chunk-b.js'"}),e(n.span,{className:"token punctuation",children:","})," ",e(n.span,{className:"token string",children:"'Greeter_onRender'"}),e(n.span,{className:"token punctuation",children:","})," ",e(n.span,{className:"token punctuation",children:"["}),"salutation",e(n.span,{className:"token punctuation",children:","})," props",e(n.span,{className:"token punctuation",children:"]"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`,e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.p,{children:[e(n.code,{children:"chunk-b.js"}),":"]}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"const"})," ",e(n.span,{className:"token function-variable function",children:"Greeter_onRender"})," ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token punctuation",children:"{"}),`
  `,e(n.span,{className:"token keyword",children:"const"})," ",e(n.span,{className:"token punctuation",children:"["}),"salutation",e(n.span,{className:"token punctuation",children:","})," props",e(n.span,{className:"token punctuation",children:"]"})," ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token function",children:"useLexicalScope"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`

  `,e(n.span,{className:"token keyword",children:"return"})," ",e(n.span,{className:"token punctuation",children:"("}),`
    `,e(n.span,{className:"token tag",children:[e(n.span,{className:"token tag",children:[e(n.span,{className:"token punctuation",children:"<"}),"span"]}),e(n.span,{className:"token punctuation",children:">"})]}),e(n.span,{className:"token plain-text",children:`
      `}),e(n.span,{className:"token punctuation",children:"{"}),"salutation",e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token plain-text",children:" "}),e(n.span,{className:"token punctuation",children:"{"}),"props",e(n.span,{className:"token punctuation",children:"."}),"name",e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token plain-text",children:`!
    `}),e(n.span,{className:"token tag",children:[e(n.span,{className:"token tag",children:[e(n.span,{className:"token punctuation",children:"</"}),"span"]}),e(n.span,{className:"token punctuation",children:">"})]}),`
  `,e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`,e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.p,{children:"Notice two changes:"}),`
`,e(n.ol,{children:[`
`,e(n.li,{children:["The ",e(n.code,{children:"QRL"})," in ",e(n.code,{children:"Greeter_onMount"})," now stores the ",e(n.code,{children:"salutation"})," and ",e(n.code,{children:"props"}),". This performs the role of capturing the constants inside closures."]}),`
`,e(n.li,{children:["The generated closure ",e(n.code,{children:"Greeter_onRender"})," now has a preamble which restores the ",e(n.code,{children:"salutation"})," and ",e(n.code,{children:"props"})," (",e(n.code,{children:"const [salutation, props] = useLexicalScope()"}),".)"]}),`
`]}),`
`,e(n.p,{children:"The ability for the Optimizer (and Qwik runtime) to capture lexically scoped constants significantly improves which functions can be extracted into lazy-loaded resources. It is a powerful tool for breaking up complex applications into smaller lazy-loadable chunks."}),`
`,e(n.h1,{id:"optimizer-rules",children:[e(n.a,{"aria-hidden":"true",tabIndex:"-1",href:"#optimizer-rules",children:e(n.span,{className:"icon icon-link"})}),"Optimizer Rules"]}),`
`,e(n.p,{children:"The Optimizer's job is to break up large applications into many small lazy-loadable chunks."}),`
`,e(n.p,{children:"The Optimizer can lazy-load a function closure, which lexically captures variables. However, there are limits to what can be achieved, and therefore the Optimizer comes with a set of rules."}),`
`,e(n.p,{children:"Since not all valid JavaScript is valid Optimizer code, keep in mind the following rules:"}),`
`,e(n.ul,{children:[`
`,e(n.li,{children:["All captured variables must be declared as a ",e(n.code,{children:"const"}),"."]}),`
`,e(n.li,{children:["All captured variables must be either:",`
`,e(n.ul,{children:[`
`,e(n.li,{children:"serializable"}),`
`,e(n.li,{children:["importable (either ",e(n.code,{children:"import"})," or ",e(n.code,{children:"export"})," in this file)"]}),`
`]}),`
`]}),`
`]}),`
`,e(n.p,{children:["The ",e(n.code,{children:"$"})," is not only a marker for the Optimizer but also a marker for the developer to follow these rules."]}),`
`,e(n.blockquote,{children:[`
`,e(n.p,{children:[e(n.strong,{children:"NOTE"}),": There are plans for a linter that will be able to enforce these rules eagerly."]}),`
`]}),`
`,e(n.h2,{id:"imports",children:[e(n.a,{"aria-hidden":"true",tabIndex:"-1",href:"#imports",children:e(n.span,{className:"icon icon-link"})}),"Imports"]}),`
`,e(n.p,{children:[e(n.strong,{children:"RULE"}),": If a function that is being extracted by Optimizer refers to a top-level symbol, that symbol must either be imported or exported."]}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"import"})," ",e(n.span,{className:"token punctuation",children:"{"})," importedFn ",e(n.span,{className:"token punctuation",children:"}"})," ",e(n.span,{className:"token keyword",children:"from"})," ",e(n.span,{className:"token string",children:"'...'"}),e(n.span,{className:"token punctuation",children:";"}),`
`,e(n.span,{className:"token keyword",children:"export"})," ",e(n.span,{className:"token function-variable function",children:"exportedFn"})," ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token punctuation",children:"{"}),e(n.span,{className:"token operator",children:"..."}),e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:";"}),`

`,e(n.span,{className:"token keyword",children:"const"})," salutation ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token string",children:'"Hello"'}),e(n.span,{className:"token punctuation",children:";"}),`

`,e(n.span,{className:"token function",children:"someApi$"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token punctuation",children:"{"}),`
  `,e(n.span,{className:"token function",children:"importedFn"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"})," ",e(n.span,{className:"token comment",children:"// OK"}),`
  `,e(n.span,{className:"token function",children:"exportedFn"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"})," ",e(n.span,{className:"token comment",children:"// OK"}),`
  salutation`,e(n.span,{className:"token punctuation",children:";"})," ",e(n.span,{className:"token comment",children:"// Error: salutation not imported/exported"}),`
`,e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:")"}),`
`]})}),`
`,e(n.p,{children:"The reason for the above rule becomes obvious when the output is examined."}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"import"})," ",e(n.span,{className:"token punctuation",children:"{"})," importedFn ",e(n.span,{className:"token punctuation",children:"}"})," ",e(n.span,{className:"token keyword",children:"from"})," ",e(n.span,{className:"token string",children:"'...'"}),e(n.span,{className:"token punctuation",children:";"}),`
`,e(n.span,{className:"token keyword",children:"export"})," ",e(n.span,{className:"token function-variable function",children:"exportedFn"})," ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token punctuation",children:"{"})," ",e(n.span,{className:"token operator",children:"..."})," ",e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:";"}),`

`,e(n.span,{className:"token keyword",children:"const"})," salutation ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token string",children:'"Hello"'}),e(n.span,{className:"token punctuation",children:";"}),`

`,e(n.span,{className:"token function",children:"someApi"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token function",children:"qrl"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token string",children:"'./chunk-a.js'"}),e(n.span,{className:"token punctuation",children:","})," ",e(n.span,{className:"token string",children:"'someApi_1'"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.p,{children:[e(n.code,{children:"chunk-a.js"}),":"]}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"import"})," ",e(n.span,{className:"token punctuation",children:"{"})," importedFn ",e(n.span,{className:"token punctuation",children:"}"})," ",e(n.span,{className:"token keyword",children:"from"})," ",e(n.span,{className:"token string",children:"'...'"}),e(n.span,{className:"token punctuation",children:";"}),`
`,e(n.span,{className:"token keyword",children:"import"})," ",e(n.span,{className:"token punctuation",children:"{"})," exportedFn ",e(n.span,{className:"token punctuation",children:"}"})," ",e(n.span,{className:"token keyword",children:"from"})," ",e(n.span,{className:"token string",children:"'./originalFile'"}),e(n.span,{className:"token punctuation",children:";"}),`

`,e(n.span,{className:"token keyword",children:"export"})," ",e(n.span,{className:"token keyword",children:"const"})," ",e(n.span,{className:"token function-variable function",children:"someApi_1"})," ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token punctuation",children:"{"}),`
  `,e(n.span,{className:"token function",children:"importedFn"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"})," ",e(n.span,{className:"token comment",children:"// OK"}),`
  `,e(n.span,{className:"token function",children:"exportedFn"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"})," ",e(n.span,{className:"token comment",children:"// OK"}),`
  salutation`,e(n.span,{className:"token punctuation",children:";"})," ",e(n.span,{className:"token comment",children:"// Error: no way to get reference to this."}),`
`,e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.h2,{id:"closures",children:[e(n.a,{"aria-hidden":"true",tabIndex:"-1",href:"#closures",children:e(n.span,{className:"icon icon-link"})}),"Closures"]}),`
`,e(n.p,{children:[e(n.strong,{children:"RULE"}),": If a function lexically captures a variable (or parameter), that variable must be (1) a ",e(n.code,{children:"const"})," and (2) the value must be serializable."]}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"function"})," ",e(n.span,{className:"token function",children:"somefn"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token punctuation",children:"{"}),`
  `,e(n.span,{className:"token keyword",children:"let"})," count ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token number",children:"0"}),e(n.span,{className:"token punctuation",children:";"}),`
  list`,e(n.span,{className:"token punctuation",children:"."}),e(n.span,{className:"token function",children:"foreach"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:"("}),"item",e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token punctuation",children:"{"}),`
    count`,e(n.span,{className:"token operator",children:"++"}),e(n.span,{className:"token punctuation",children:";"}),`
    `,e(n.span,{className:"token keyword",children:"const"})," currentCount ",e(n.span,{className:"token operator",children:"="})," count",e(n.span,{className:"token punctuation",children:";"}),`
    `,e(n.span,{className:"token function",children:"someApi$"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token punctuation",children:"{"}),`
      item`,e(n.span,{className:"token punctuation",children:";"})," ",e(n.span,{className:"token comment",children:"// OK (assuming serializable)"}),`
      count`,e(n.span,{className:"token punctuation",children:";"})," ",e(n.span,{className:"token comment",children:"// ERROR: count not const"}),`
      currentCount`,e(n.span,{className:"token punctuation",children:";"})," ",e(n.span,{className:"token comment",children:"// OK (assuming serializable)"}),`
    `,e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
  `,e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`,e(n.span,{className:"token punctuation",children:"}"}),`
`]})}),`
`,e(n.p,{children:"Again looking at the generated code reveals why these rules must be so:"}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"function"})," ",e(n.span,{className:"token function",children:"somefn"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token punctuation",children:"{"}),`
  `,e(n.span,{className:"token keyword",children:"let"})," count ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token number",children:"0"}),e(n.span,{className:"token punctuation",children:";"}),`
  list`,e(n.span,{className:"token punctuation",children:"."}),e(n.span,{className:"token function",children:"foreach"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:"("}),"item",e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token punctuation",children:"{"}),`
    count`,e(n.span,{className:"token operator",children:"++"}),e(n.span,{className:"token punctuation",children:";"}),`
    `,e(n.span,{className:"token keyword",children:"const"})," currentCount ",e(n.span,{className:"token operator",children:"="})," count",e(n.span,{className:"token punctuation",children:";"}),`
    `,e(n.span,{className:"token function",children:"someApi$"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token function",children:"qrl"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token string",children:"'./chunk-a.js'"}),e(n.span,{className:"token punctuation",children:","})," ",e(n.span,{className:"token string",children:"'_1'"}),e(n.span,{className:"token punctuation",children:","})," ",e(n.span,{className:"token punctuation",children:"["}),"item",e(n.span,{className:"token punctuation",children:","})," count",e(n.span,{className:"token punctuation",children:","})," currentCount",e(n.span,{className:"token punctuation",children:"]"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
  `,e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`
`,e(n.span,{className:"token punctuation",children:"}"}),`
`]})}),`
`,e(n.p,{children:[e(n.code,{children:"chunk-a.js"}),":"]}),`
`,e(n.pre,{children:e(n.code,{className:"language-tsx",children:[e(n.span,{className:"token keyword",children:"export"})," ",e(n.span,{className:"token function-variable function",children:"_1"})," ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"})," ",e(n.span,{className:"token operator",children:"=>"})," ",e(n.span,{className:"token punctuation",children:"{"}),`
  `,e(n.span,{className:"token keyword",children:"const"})," ",e(n.span,{className:"token punctuation",children:"["}),"item",e(n.span,{className:"token punctuation",children:","})," count",e(n.span,{className:"token punctuation",children:","})," currentCount",e(n.span,{className:"token punctuation",children:"]"})," ",e(n.span,{className:"token operator",children:"="})," ",e(n.span,{className:"token function",children:"useLexicalScope"}),e(n.span,{className:"token punctuation",children:"("}),e(n.span,{className:"token punctuation",children:")"}),e(n.span,{className:"token punctuation",children:";"}),`

  item`,e(n.span,{className:"token punctuation",children:";"})," ",e(n.span,{className:"token comment",children:"// OK (assuming serializable)"}),`
  count`,e(n.span,{className:"token punctuation",children:";"})," ",e(n.span,{className:"token comment",children:"// ERROR: count not const"}),`
  currentCount`,e(n.span,{className:"token punctuation",children:";"})," ",e(n.span,{className:"token comment",children:"// OK (assuming serializable)"}),`
`,e(n.span,{className:"token punctuation",children:"}"}),e(n.span,{className:"token punctuation",children:";"}),`
`]})}),`
`,e(n.p,{children:["See ",e(n.a,{href:"https://qwik.builder.io/docs/concepts/resumable#serialization",children:"serialization"})," for discussion of what is serializable."]})]})}function r(a={}){const{wrapper:n}=a.components||{};return n?e(n,Object.assign({},a,{children:e(s,a)})):s(a)}export{r as default,i as frontmatter,l as head,o as headings};
