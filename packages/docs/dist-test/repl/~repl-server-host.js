const L=(a,l,d)=>{const s=a.location.hash.slice(1);if(!/^[a-z0-9]+$/.test(s)){console.error("Qwik REPL server missing valid client id");return}let i=null,p=null;const m=t=>{const e=l.createElement("iframe");e.classList.add("loading"),e.src="/repl/"+t.clientId+"/",e.dataset.buildId=String(t.buildId),e.addEventListener("load",()=>{var r;if(!e.nextElementSibling){e.classList.remove("loading");const n=(r=e.parentElement)==null?void 0:r.querySelectorAll("iframe");if(n)for(let c=n.length-1;c>=0;c--){const f=n[c];f!==e&&f.remove()}o({type:"apploaded",clientId:s})}}),l.body.appendChild(e)},v=t=>{if(i&&i.active)try{t.data&&i.active.postMessage(t.data)}catch(e){console.error("receiveMessageFromMainApp",e,t.data)}},o=t=>{t.clientId===s&&a.parent.postMessage(t,"*")},E=t=>{const e=t.data;e&&(o(e),e.type==="result"&&m(e))},u=t=>{if(t.data){const e=JSON.parse(t.data);(e==null?void 0:e.type)==="event"&&o(e)}},g=()=>{clearTimeout(p),console.debug('Qwik REPL server "%s" ready',s),d.serviceWorker.addEventListener("message",E),a.addEventListener("message",u),o({type:"replready",clientId:s})};a.parent===a?console.error('Qwik REPL server "%s" is not an iframe window',s):(p=setTimeout(()=>{console.error('Qwik REPL server "%s" has not initialized',s)},15e3),d.serviceWorker.register("/repl/repl-sw.js",{scope:"/repl/"}).then(t=>{i=t,i.active?(console.debug('Qwik REPL server "%s" service worker registration active',s),g(),t.addEventListener("updatefound",()=>{const e=t.installing;if(e){let r=!1;e.addEventListener("statechange",()=>{e.state=="activated"&&(r||(r=!0,a.parent.location.reload()))})}})):i.installing&&i.installing.addEventListener("statechange",e=>{var r,n;((r=e==null?void 0:e.target)==null?void 0:r.state)=="activated"?g():console.debug('Qwik REPL server "%s" statechange: %s',s,(n=e==null?void 0:e.target)==null?void 0:n.state)})},t=>{console.error('Qwik REPL Server "%s" service worker registration failed:',s,t)}).catch(t=>console.error(t)),l.title+=": "+s,a.addEventListener("message",v))};L(window,document,navigator);
